<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindMate | Dashboard Integrado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f7f4; color: #3a3a3a; }
        .module-color-body { --module-color: #ef4444; } .module-color-mind { --module-color: #3b82f6; }
        .module-color-family { --module-color: #22c55e; } .module-color-work { --module-color: #f97316; }
        .module-color-finance { --module-color: #8b5cf6; } .module-color-purpose { --module-color: #eab308; }
        .module-color-bridge { --module-color: #64748b; } .module-color-default { --module-color: #9ca3af; }
        .module-item-border { border-left: 4px solid var(--module-color); }
    </style>
</head>
<body class="antialiased">
    <div id="app" class="container mx-auto p-4 md:p-8">
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-gray-800">MindMate Dashboard</h1>
        </header>
        <main>
            </main>
    </div>

    <div id="fab-container" class="fixed bottom-8 right-8 z-40">
        <button onclick="openQuickAddModal()" class="w-16 h-16 bg-blue-600 rounded-full text-white flex items-center justify-center text-3xl shadow-lg">+</button>
    </div>

    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div id="modal-content" class="bg-white rounded-2xl shadow-xl w-full max-w-2xl p-8"></div>
    </div>

    <script type="module">
        async function callMindMateGem(text) {
            const submitBtn = document.getElementById('quick-add-submit');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Processando...';

const SCRIPT_URL = "https://script.google.com/macros/s/AKfy.../exec";            
            // Constrói a URL com os parâmetros para a requisição GET
            const urlWithParams = new URL(SCRIPT_URL);
            urlWithParams.searchParams.append('action', 'processText');
            urlWithParams.searchParams.append('text', text);

            try {
                // ATENÇÃO: a requisição agora é GET e não tem 'body'
                const response = await fetch(urlWithParams, {
                    method: 'GET',
                });

                if (!response.ok) {
                  throw new Error(`A resposta da rede não foi 'ok': ${response.statusText}`);
                }

                const result = await response.json();

                if (result.success && result.gemResponse) {
                    return result.gemResponse;
                } else {
                    throw new Error(result.error || 'A API retornou uma resposta inválida.');
                }

            } catch (error) {
                console.error("Erro ao chamar a API do MindMate:", error);
                alert("Falha ao processar sua entrada. Verifique o console para mais detalhes. Erro: " + error.message);
                return null;
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Processar com IA';
            }
        }

        // --- O restante do seu código JavaScript (funções de renderização, etc.) vai aqui ---
        // Exemplo:
        window.openQuickAddModal = () => {
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <h2 class="text-2xl font-bold mb-4">Captura Rápida</h2>
                <textarea id="quick-add-input" class="w-full p-2 border rounded-lg" rows="4" placeholder="Ex: revisar o relatório de finanças #mod_finance para amanhã às 10:00"></textarea>
                <div class="mt-4 flex justify-end gap-2">
                    <button onclick="closeModal()" class="py-2 px-4 bg-gray-200 rounded-lg">Cancelar</button>
                    <button id="quick-add-submit" class="py-2 px-4 bg-blue-600 text-white rounded-lg">Processar com IA</button>
                </div>
            `;
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.getElementById('quick-add-input').focus();

            document.getElementById('quick-add-submit').onclick = async () => {
                const input = document.getElementById('quick-add-input').value.trim();
                if (!input) return;
                const gemResponse = await callMindMateGem(input);
                if (gemResponse) {
                    // Aqui você chamaria a função que mostra o modal de confirmação
                    alert("Sucesso! Resposta recebida: " + gemResponse.classificacao.nome_atividade);
                    closeModal();
                }
            };
        };

        window.closeModal = () => {
            document.getElementById('modal').classList.add('hidden');
        };
    </script>
</body>
</html>
